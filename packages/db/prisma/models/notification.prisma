enum NotificationType {
  ISSUE_ASSIGNED
  ISSUE_CREATED
  COMMENT_CREATED
  MENTION
  STATE_CHANGE
}

enum IssueStatus {
  TRIAGE
  BACKLOG
  UNSTARTED
  STARTED
  IN_REVIEW
  COMPLETED
  CANCELLED
}

enum IssuePriority {
  NO_PRIORITY
  URGENT
  HIGH
  MEDIUM
  LOW
}

model Notification {
  id             String       @id @default(uuid())
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  userId         String
  user           User         @relation(name: "NotificationRecipient", fields: [userId], references: [id], onDelete: Cascade)
  actorId        String?
  actor          User?        @relation(name: "NotificationActor", fields: [actorId], references: [id])

  type     NotificationType
  entityId String

  issueStatus   IssueStatus
  issuePriority IssuePriority

  link String

  data         Json?
  readAt       DateTime?
  snoozedUntil DateTime?
  archivedAt   DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([organizationId])
  @@index([userId, readAt])
  @@index([userId, snoozedUntil])
  @@index([userId, archivedAt])
  @@index([entityId])
  @@map("notification")
}
